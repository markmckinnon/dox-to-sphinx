<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Autopsy Developer Documentation: Regression Testing in Autopsy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Autopsy Developer Documentation<span id="projectnumber">&#160;4.19.3</span>
   </div>
   <div id="projectbrief">Graphical digital forensics platform for The Sleuth Kit and other tools.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Autopsy Developer&#39;s Guide</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Regression Testing in Autopsy </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_regression"></a>
Introduction</h1>
<p>The autopsy/test folder contains scripts that are necessary to run the regression test. Developers that are interested in running regression tests should run autopsy/test/script/regression.py. This guide will familiarize you with regression.py and walk you through a simple example at the end.</p>
<p>From a bird’s eye view, regression.py will:</p><ul>
<li>Run ingest on an image by starting up Autopsy and controlling the UI</li>
<li>Generate a HTML report once ingest is complete</li>
<li><a class="el" href="regression_testing.html#dump">Dump</a> the case database and perform <a class="el" href="regression_testing.html#diff">diffs</a> on the <a class="el" href="regression_testing.html#gold_standard">gold standards</a>. HTML reports are also <a class="el" href="regression_testing.html#diff">diffed</a>.</li>
</ul>
<p>What’s important is that regression.py will enable you to isolate changes that you may have caused while developing and adding features.</p>
<p>Regression.py is also responsible for producing and saving gold standards for you. This allows your gold standards to evolve as your source code changes. In the following sections, we will learn how to accomplish this and what regression.py will need to know in order to run smoothly. </p>
<h1><a class="anchor" id="general"></a>
General</h1>
<p>Regression.py will use the most recent Autopsy and Sleuthkit builds as a launching point. To ensure that your latest changes are included, you will need to make sure you build. </p>
<h1><a class="anchor" id="terminology"></a>
Terminology</h1>
<p>Before we jump in, let's start off by defining some common terminology.</p><ul>
<li><a class="anchor" id="dump"></a>Dump<ul>
<li>A dump refers to writing all case database INSERT statements to file. The case database is what Autopsy uses to persist its analysis. Items that are time or execution order dependent are obfuscated so that only meaningful changes are captured.</li>
</ul>
</li>
<li><a class="anchor" id="gold_standard"></a>Gold standard<ul>
<li>A gold standard is simply a dump that we designate to be the base expectation for any given ingest run. Some changes may add to this base (potentially positive) and some may modify or remove from this base (potentially negative). HTML reports will also be saved as gold standards.</li>
</ul>
</li>
<li><a class="anchor" id="diff"></a>Diff<ul>
<li>A diff is the result of running the <a href="http://man7.org/linux/man-pages/man1/diff.1.html">diff</a> command against a new dump and a corresponding gold standard. If there are any regressions, they will hopefully be captured in these files.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="param_desc"></a>
Parameter Descriptions</h1>
<p>Now that we have defined some common terminology, we can move on to learning which command line arguments regression.py can recognize. A regression test (one that may produce diffs) is the default unless otherwise specified. One and only one of the bolded arguments is required.</p><ul>
<li><b>-f PATH</b><ul>
<li>This indicates that a regression test should be run on a single image at the following PATH. However, it is strongly recommended that you specify an image (even if just one) in a config file instead (see -l below). There are no guarantees that this will be maintained as we are not currently using it internally.</li>
</ul>
</li>
<li>-r (for rebuild)<ul>
<li>This indicates that the gold standards should be rebuilt (overwritten) rather than diffed against. Rebuilds are necessary in order to update the gold standards for new (approved) diffs. This parameter needs no additional arguments.</li>
</ul>
</li>
<li>-b (for both compare and rebuild)<ul>
<li>This indicates that diffs should be produced on the current gold standards and then overwritten with new ones. It’s recommended to separate this behavior if you are not using version control on your gold standards. This is logically equivalent to running a regression test and then running with -r. This parameter needs no additional arguments.</li>
</ul>
</li>
<li><b>-l PATH</b><ul>
<li>This parameter specifies the PATH to the config file. The config file is very important and has its own <a class="el" href="regression_testing.html#creating_config_file">Creating a Config File</a> section.</li>
</ul>
</li>
<li>-u (Ignore unallocated space)<ul>
<li>Unallocated space can take a long time to ingest. Depending on your use case, you may omit processing unallocated space on all images. This parameter needs no additional arguments.</li>
</ul>
</li>
<li>-k (Do not delete the Solr index)<ul>
<li>This parameter indicates that the Solr index should be kept (rather than deleted) for each case. Some keyword hits will be written to the case database, however it may be useful to keep the index around if you’d like to debug or perform additional analysis. This parameter needs no additional arguments.</li>
</ul>
</li>
<li>-o PATH (path to output folder for diff files)<ul>
<li>This parameter indicates that diff files from multiple images should be aggregated into one folder at the specified PATH. If this argument is omitted, the diffs for an image can be found in its respective case output directory.</li>
</ul>
</li>
<li>-v (verbose mode)<ul>
<li>This parameter indicates that all ingest logs should automatically be printed to console. This parameter needs no additional arguments.</li>
</ul>
</li>
<li>-e ARG (Enable exception mode with given string)<ul>
<li>This parameter indicates that all lines from the ingest logs that contain the given ARG string should be printed to console. e.g. ‘-e IOException’</li>
</ul>
</li>
<li>-h (help)</li>
</ul>
<h1><a class="anchor" id="creating_config_file"></a>
Creating a Config File</h1>
<p>The config file is essential to giving regression.py the details it needs to run. This file is simply an XML file with some expected tag names. We’ll dive into the tag names and their descriptions in the <a class="el" href="regression_testing.html#tag_def">Tag Definitions</a> section. But first, let’s start by taking a look at a template.</p>
<h2><a class="anchor" id="template"></a>
Template</h2>
<p>Here is a complete config file template: </p><div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;ASCII&quot;</span>?&gt;</div>
<div class="line"><span class="comment">&lt;!-- Configuration File for Regression Testing --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">Properties</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">build</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;..\..\Testing&quot;</span>/&gt;</div>
<div class="line">        <span class="comment">&lt;!-- List all the images you would like to run through ingest. --&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">image</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;path/to/my/first/test/image.img&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">image</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;path/to/my/second/test/image.001&quot;</span>/&gt;</div>
<div class="line">        <span class="comment">&lt;!-- Logical File Set --&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">image</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;path/to/my/third/test/documents_folder&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        &lt;<span class="keywordtype">singleUser_golddir</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;path/to/my/gold/dir/single_user&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">singleUser_outdir</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;path/to/my/output/dir&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">&lt;!-- Consider execution time as a test metric --&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">timing</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;True&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">&lt;!-- Multi-user case settings --&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">multiUser_outdir</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;\\YourSharedDriveName\path\to\output\dir&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">multiUser_golddir</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;path/to/my/gold/dir/multi_user&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">&lt;!--Please input the PostgreSQL database connection information.--&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">dbHost</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;myDBHostName&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dbPort</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;myDBPortNumber&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dbUserName</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;myDBUsername&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">dbPassword</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;myDBPassword&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">&lt;!--Please input the Solr connection information.--&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">solrHost</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;mySolrHostName&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">solrPort</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;mySolrHostPortNumber&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">&lt;!--Please input the ActiveMQ connection information.--&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">messageServiceHost</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;myActiveMQHostName&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">messageServicePort</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;myActiveMQPortNumber&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">&lt;!-- Indicate the type of test to run (single, multi, or both) --&gt;</span></div>
<div class="line">        &lt;<span class="keywordtype">userCaseType</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Both-user&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">Properties</span>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="tag_def"></a>
Tag Definitions</h2>
<p>With our template above, let’s break down what some of these tags mean:</p><ul>
<li>&lt;userCaseType&gt;<ul>
<li>The value of this tag specifies the type of case that should be produced during the regression test. This may be significant since multi-user and single-user cases use different databases. Specify this value as “Single-user” to create only single user cases, “Multi-user” to create only multi-user cases, or “Both-user” to create both for each &lt;image&gt;. “Both-user” does two passes over all &lt;image&gt; tags. The first will be run as “Single-user” and the second will be run as “Multi-user”. Each &lt;image&gt; gets its own case.</li>
</ul>
</li>
<li>&lt;build&gt;<ul>
<li>This specifies the path to the Autopsy/Testing folder. This directory has code that will control the Autopsy UI during ingest. You can leave this path as relative, since the regression.py file already lives in the autopsy repository.</li>
</ul>
</li>
<li>&lt;image&gt;<ul>
<li>The value of this tag is the path to the image that will be ingested. A new case will be created for each one. You may have any number of image tags, but at least one.</li>
</ul>
</li>
<li>&lt;singleUser_golddir&gt;<ul>
<li>The value of this tag specifies the path to the directory that contains single user (See &lt;userCaseType&gt;) gold standards for each &lt;image&gt; tag. This will also be the place that new single user gold standards will be saved when run in rebuild mode (-r).</li>
</ul>
</li>
<li>&lt;singleUser_outdir&gt;<ul>
<li>The value of this tag will be the location on disk that single user case output (See &lt;userCaseType&gt;) will be stored. Each image will create a case folder in this directory.</li>
</ul>
</li>
<li>&lt;timing&gt;<ul>
<li>The value of this tag indicates that ingest time should be considered a test metric.</li>
</ul>
</li>
<li>&lt;multiUser_golddir&gt;<ul>
<li>The value of this tag specifies the path to the directory that contains multi user (see &lt;userCaseType&gt;) gold standards for each &lt;image&gt; tag. This will also be the place that new multi user gold standards will be saved when run in rebuild mode (-r).</li>
</ul>
</li>
<li>&lt;multiUser_outdir&gt;<ul>
<li>The value of this tag will be the location on disk that multi user case output (See &lt;userCaseType&gt;) will be stored. Each image will create a case folder in this directory. It is highly recommended that this folder be shared and the value be a UNC path.</li>
</ul>
</li>
<li>&lt;dbHost&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag indicates the host name of the machine running the PostgreSQL database that Autopsy will use during ingest.</li>
</ul>
</li>
<li>&lt;dbPort&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag indicates the port number that the PostgreSQL database is listening on at &lt;dbHost&gt;.</li>
</ul>
</li>
<li>&lt;dbUserName&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag represents the database user Autopsy will act as when adding records to the case database on &lt;dbHost&gt; and &lt;dbPort&gt;.</li>
</ul>
</li>
<li>&lt;dbPassword&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag represents the password to the &lt;dbUserName&gt; that Autopsy will act as when adding records to the case database on &lt;dbHost&gt; and &lt;dbPort&gt;.</li>
</ul>
</li>
<li>&lt;solrHost&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag indicates the host name of the Solr service. The solr service is needed when running keyword search.</li>
</ul>
</li>
<li>&lt;solrPort&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag indicates the port number Solr is listening on at &lt;solrHost&gt;.</li>
</ul>
</li>
<li>&lt;messageServiceHost&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag indicates the host name of the ActiveMQ service that Autopsy will use for message brokerage between clients.</li>
</ul>
</li>
<li>&lt;messageServicePort&gt;<ul>
<li>This tag is only relevant when run in multi user mode (See &lt;userCaseType&gt;). The value of this tag indicates the port number that the ActiveMQ service is listening on at &lt;messageServiceHost&gt;.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="example"></a>
Simple Example</h1>
<p>Now that we are familiar with the parameter types and config file definitions, let's walk through a simple example. In this example, we are going to do a rebuild to establish our gold standards, introduce a regression, and discover it by running a test and examining the diffs. </p>
<h2><a class="anchor" id="wrkspace"></a>
Workspace</h2>
<p>Here is how our workspace is set up:</p>
<div class="image">
<img src="regression_example_workspace-env.PNG" alt=""/>
</div>
<ul>
<li>autopsy, sleuthkit<ul>
<li>These folders are clones of the Autopsy and Sleuthkit GitHub repositories. Sleuthkit was built using sleuthkit/win32/updateAndBuildAll.py and Autopsy was built in Netbeans 8.2.</li>
</ul>
</li>
<li>autopsy_regression_config<ul>
<li>This folder contains the regression_config.xml that is covered in the next subsection.</li>
</ul>
</li>
<li>autopsy_single_gold<ul>
<li>This folder will contain the gold standards for the &lt;image&gt; tags we define in the config file.</li>
</ul>
</li>
<li>autopsy_single_output<ul>
<li>This folder will contain the case output for each &lt;image&gt; tag ingest.</li>
</ul>
</li>
<li>small2<ul>
<li>The image that we will be used in our regression testing.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="config_file"></a>
Config File</h2>
<p>Here is the config file we will be using for our regression testing. This file is located in the autopsy_regression_config folder.</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;ASCII&quot;</span>?&gt;</div>
<div class="line"><span class="comment">&lt;!-- Configuration File for Regression Testing --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">Properties</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">image</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;C:\test-env\small2.img&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">build</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;..\..\Testing&quot;</span>/&gt;</div>
<div class="line"> </div>
<div class="line">        &lt;<span class="keywordtype">singleUser_golddir</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;C:\test-env\autopsy_single_gold&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">singleUser_outdir</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;C:\test-env\autopsy_single_output&quot;</span>/&gt;&gt;</div>
<div class="line"> </div>
<div class="line">        &lt;<span class="keywordtype">userCaseType</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;Single-user&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">Properties</span>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="rebuild"></a>
Rebuilding Gold Standards</h2>
<p>In order to produce diffs, we need to first establish gold standards. We can do this by performing a rebuild (see -r in <a class="el" href="regression_testing.html#param_desc">Parameter Descriptions</a>).</p>
<p>Let’s run the following command from within autopsy/test/script directory.</p>
<div class="image">
<img src="regression_example_rebuild-command.PNG" alt=""/>
</div>
<p>This will instruct regression.py to make gold standards using our config file.</p>
<p>Regression.py is going to start ingesting the images found in the config file one by one from top to bottom. An ant command will be printed to console so we can see exactly what is being run. The Autopsy UI should become visible shortly after. Refrain from clicking on anything as this may interrupt the regression process.</p>
<p>When this process is complete, the directory specified in &lt;singleUser_golddir&gt; should be populated with our gold standards. Here is what our folder looks like after the rebuild:</p>
<div class="image">
<img src="regression_example_gold-dir.PNG" alt=""/>
</div>
<h2><a class="anchor" id="perform_reg_test"></a>
Performing a Regression Test</h2>
<p>Now that we have our gold standards, it’s time to start our development cycle. Let's pretend we accidentally introduced a MIME type regression. All MIME types that were once text/plain are now mistakenly labeled as text/error-plain. Using the diffs that regression.py will produce, we can catch this before it becomes a problem.</p>
<p>Let’s run the following command from within the autopsy/test/script directory.</p>
<div class="image">
<img src="regression_example_run-command.PNG" alt=""/>
</div>
<p>This will instruct regression.py to run a regression test using our config file.</p>
<p>Like the rebuild, an ant command will be printed to console so we can see exactly what is being run. Autopsy should become visible shortly. Refrain from clicking on anything as this may interrupt the regression process.</p>
<p>After completing on an image, Autopsy will disappear and you will be presented with a brief summary of the results (which may take some time to compute). Diffs that did not pass will be located in the output directory of the image. This process will continue for all images in the config file.</p>
<p>Since we only had one image in our config file and we ran in single-user mode, regression.py is finished. As expected, our case database diffs did not pass:</p>
<div class="image">
<img src="regression_example_diff-failure.PNG" alt=""/>
</div>
<p>We’ll learn how to examine our diffs in the next section. </p>
<h2><a class="anchor" id="examine_diffs"></a>
Examining the Diffs</h2>
<p>Let’s start by opening up our output folder:</p>
<div class="image">
<img src="regression_example_output-folder.PNG" alt=""/>
</div>
<p>Each timestamp corresponds to the start of a regression or rebuild run. The most recent folder is where our latest diff will be contained. A folder named “small2” will be in this directory. Diff files will be stored at the top level of the image directory.</p>
<p>As expected, there is a DBDump-Diff file waiting for us.</p>
<div class="image">
<img src="regression_example_case-output-folder.PNG" alt=""/>
</div>
<p>We can examine our regressions by opening this file in Notepad++:</p>
<div class="image">
<img src="regression_example_diff.PNG" alt=""/>
</div>
<p>Since our dumps are INSERT statements from the database, we can see exactly which files have changed.</p>
<p>A line that’s preceded by a “&lt;” indicates the record in the gold standard. A line that’s preceded by a “&gt;” indicates the record in the current dump. As you can see on the second line, our MIME type was mistakenly changed. In the event that this change was correct, we can overwrite our current gold standards by running another rebuild (see -r in <a class="el" href="regression_testing.html#param_desc">Parameter Descriptions</a>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<hr/>
<p><i>Copyright &#169; 2012-2022 Basis Technology. Generated on Fri Feb 24 2023<br/> 
This work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">Creative Commons Attribution-Share Alike 3.0 United States License</a>.
</i></p>
</body>
</html>
