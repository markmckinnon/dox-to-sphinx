<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Autopsy User Documentation: Upgrading to Autopsy 4.18.0 (with Solr 8)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Autopsy User Documentation<span id="projectnumber">&#160;4.19.3</span>
   </div>
   <div id="projectbrief">Graphical digital forensics platform for The Sleuth Kit and other tools.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Autopsy User&#39;s Guide</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Upgrading to Autopsy 4.18.0 (with Solr 8) </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#solr8_upgrade_cluster">Multi-User Cluster Options</a><ul><li class="level2"><a href="#solr8_upgrade_cluster_solr">Multiple Solr Servers</a></li>
<li class="level2"><a href="#install_solr_zk_migration">Migration Of ZooKeeper Data</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Autopsy 4.18.0 and beyond will make new cases with Solr 8 instead of Solr 4. Because Solr 8 is not backward compatable with Solr 4, this will have some impact on you. Notably:</p>
<ul>
<li>Cases made with 4.17.0 and earlier will continue to use Solr 4 indexes and can be opened with Autopsy 4.18.0+</li>
<li>Cases made with 4.18.0 and later will use Solr 8 and cannot be opened by Autopsy 4.17.0 and earlier. The main take away is that you can open older cases, but new cases can't be opened by older software.</li>
</ul>
<p>If you are using single-user cases, there is nothing else for you to do. Autopsy ships with both Solr 4 and 8 embedded.</p>
<p>If you are using a multi-user cluster, then you'll need to install a new Solr 8 server and may choose to keep Solr 4 around too.</p>
<h1><a class="anchor" id="solr8_upgrade_cluster"></a>
Multi-User Cluster Options</h1>
<p>There are two considerations when ugprading a multi-user cluster:</p><ul>
<li>Which versions of Solr servers to run</li>
<li>Where to store ZooKeeper data</li>
</ul>
<p>The following sections cover these topics in more detail.</p>
<h2><a class="anchor" id="solr8_upgrade_cluster_solr"></a>
Multiple Solr Servers</h2>
<p>You will most likely want to have both Solr 4 and 8 servers running so that you can open older cases. If so, then:</p><ul>
<li>Get a new server and install Solr 8 on it using the <a class="el" href="install_solr_page.html">Install and Configure Solr</a> page instructions.</li>
<li>Configure each Autopsy client to have the addresses for both servers (see below).</li>
</ul>
<p>If you want to have only Solr 8, then simply follow the instructions for Solr 8 and get rid of the Solr 4 server. You will not be able to open older cases. It is possible to upgrade Solr indexes, but we have not tested this.</p>
<p>To configure Autopsy to be able to connect to both Solr 8 and Solr 4 multi-user servers, start Autopsy and open the multi-user settings panel from "Tools", "Options", "Multi-user". Note that in order to create or open Multi-user cases, "Enable Multi-user cases" must be checked and the settings below must be correct.</p>
<p>It is recommended that you run Solr 8 and Solr 4 servers on separate machines. In the example below, Solr 8 server is running on a machine with host name "Solr1" and Solr 4 server is running on a machine with host name "Solr6".</p>
<div class="image">
<img src="solr_running_in_parallel.png" alt=""/>
</div>
<p>Once both the Solr 8 and Solr 4 multi-user server connection info is entered and saved, Autopsy will be able to open both Solr 8 multi-user cases (Autopsy version 4.18.0 and later), as well as legacy existing Solr 4 multi-user cases (cases created with Autopsy versions 4.17.0 and earlier).</p>
<p><b>IMPORTANT</b>: The "Test Connection" button does not verify which version of Solr Autopsy is connecting to. It only verifies that Autopsy is connecting to a Solr server and is able to receive a response. Therefore it is important that the user enters correct server connection info in appropriate fields.</p>
<p>If you intend to run Solr 4 and Solr 8 servers on the same machine at the same time, you need to change the port of the Solr 8 service using the setting <b>SOLR_PORT</b> in <code>"C:\solr-8.6.3\bin\solr.in.cmd"</code> file (assuming that the Solr package ZIP was extracted into <code>"C:\solr-8.6.3\" directory). By default the Solr service starts on port 8983. 

@subsection install_solr_zk_migration Migration Of ZooKeeper Data

In addition to text indexing, the Solr service also stores "coordination" data using Apache ZooKeeper. You'll want to move this data if you get rid of your Solr 4 server.  This data allows you to:
- Know what multi-user cases you can open
- Know which disk images were already processed for auto-ingest

You can continue to use your Solr 4 instance of ZooKeeper, but we also have a utility that allows you to migrate the data to a new server, such as the one running Solr 8 (or a stand-alone instance). 

In our example we will be migrating ZooKeeper data from a ZooKeeper server running on a Solr 4 server (on machine "Solr6") to a brand new ZooKeeper server running on a Solr 8 server (on machine "Solr1"). 

You can browse the existing ZooKeeper data if you go to Solr6 machine and open the Solr admin console (http://localhost:8983/solr/#/). In the Solr admin console, navigate to "Cloud"-&gt; "Tree", and expand the "autopsy" section of the tree:

@image html solr_zk_migration_1.png

You can follow the same steps to browse the ZooKeeper data on the new Solr 8 server (on "Solr1" machine). If Autopsy has not been used with this server yet, the "autopsy" folder will be missing, as in the example below:

@image html solr_zk_migration_2.png

The ZooKeeper migration utility (ZookeeperNodeMigration.jar) is located in \c "C:\Program</code>  Files(current version of Autopsy)\autopsy\ZookeeperNodeMigration" directory:

@image html solr_zk_migration_3.png

ZookeeperNodeMigration utility requires the following inputs: 
&lt;ul&gt;
&lt;li&gt;Input Zookeeper IP Address or Hostname
&lt;li&gt;Input Zookeeper Port Number
&lt;li&gt;Output Zookeeper IP Address or Hostname
&lt;li&gt;Output Zookeeper Port Number
&lt;/ul&gt;

For example, if you execute the following command from command line, the Zookeeper nodes will get copied from Zookeeper server on Solr6:9983 to Zookeeper server on Solr1:9983 :

&lt;blockquote&gt;&amp;zwj;java -jar ZookeeperNodeMigration.jar Solr6 9983 Solr1 9983
&lt;/blockquote&gt;
@image html solr_zk_migration_4.png

If you do not have Java installed on the machine, you can use the packaged version of Java that is distributed along with Autopsy. For example:

&lt;blockquote&gt;&amp;zwj;\c "C:\Program Files\Autopsy-4.18.0\jre\bin\java.exe" -jar ZookeeperNodeMigration.jar Solr6 9983 Solr1 9983 
&lt;/blockquote&gt;
To verify that the ZooKeeper data has been copied from the Solr6 server to the Solr1 server, refresh the Solr admin console on the Solr1 machine. You should now see the "autopsy" directory, along with its contents, when you go to the "Cloud" -&gt; "Tree" section of the Solr admin console:</p>
<div class="image">
<img src="solr_zk_migration_5.png" alt=""/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<hr/>
<p><i>Copyright &#169; 2012-2022 Basis Technology. Generated on Fri Feb 24 2023<br/> 
This work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">Creative Commons Attribution-Share Alike 3.0 United States License</a>.
</i></p>
</body>
</html>
